        <% $fullpath = request.fullpath %>
        <% p "###################################" %>
        <% p $fullpath %>
        <% p request.url %>
 
        <div class="container">
          <div style="width:800px;">
            <div style="width:400px; float:left;">
              <div style="width:392px; float:left; margin-left:4px;">
                <div>
                  <div id="divSetOutput" style="background-color:#f0f0f0; border: 1px solid #e4e4e4; border-radius:3px; padding: 5px;"><span class="glyphicon glyphicon-log-out"></span><span id="setOutput" style="padding-left:8px;"></span></div>
                </div>
              </div>
            </div>

            <div style="width:400px; float:left;">
              <div style="width:400px;">
                <div style="float:right; margin-bottom: 6px;">
                  <div style="float:right;"><input id="resetAllController" class="btn btn-warning panicButton" type="button" value="Panic"></div>
                </div>
                
                <div style="float:right; margin-bottom: 6px;">
                  <div class="btn-group" style="margin-right:12px;">
                    <button type="button" class="btn btn-default" id="zero" style="height:34px;"><span class="glyphicon glyphicon-fast-backward"></span></button>
                    <button type="button" class="btn btn-default" id="start" style="height:34px; width:60px;"><span id="startButton" class="glyphicon glyphicon-play"></span></button>
                    <button type="button" class="btn btn-default" id="stop" style="height:34px;"><span class="glyphicon glyphicon-stop"></span></button>
                  </div>
                </div>

                <div class="input-group" style="width: 170px; float:right; margin-right:12px;">
                  <span class="input-group-addon"><span class="glyphicon glyphicon-heart"></span> Tempo</span>
                  <input type="number" class="form-control" placeholder="Set Tempo" id="tempo" value="120">
                </div>

              </div>
            </div>
          </div>
          <div style="clear:both;"></div>

          <div style="margin-top:10px;"></div>

          <ul id="tracks" class="nav nav-tabs" style="width:800px;">
            <li class="active"><a href="#pianorolltab" data-toggle="tab">Ch 1</a></li>
            <li id="add" class="deactive" style="float:right;"><a href="#pianorolltab" data-toggle="tab">追加</a></li>
          </ul>
          
          
          <!-- ピアノロール　ここから -->
          <div class="tab-content">
            <div class="tab-pane active" id="pianorolltab">
              
              <br style="clear:both;">
              <div style="margin-top:5px;"></div>
              
              <div style="width: 800px;">
              <div class="input-group">
                <div class="input-group-btn">
                  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">Mode <span class="caret"></span></button>
                  <ul class="dropdown-menu">
                    <li><a href="#" id="inputTextMode"><span class="glyphicon glyphicon-pencil"></span> InputText</a></li>
                    <li><a href="#" id="autoDoremiMode"><span class="glyphicon glyphicon-music"></span> DoReMi</a></li>
                  </ul>
                </div><!-- /btn-group -->
                
                <span class="input-group-addon" id="modeName"><span class="glyphicon glyphicon-pencil"></span> InputText</span>
                <input type="text" class="form-control" id="inputText" placeholder="Input Text" value="どれみふぁそらしど">
                <span class="input-group-btn">
                  <button class="btn btn-primary" type="button" id="inputTextButton">Send</button>
                </span>
              </div><!-- /input-group -->
              <div style="margin:2px 0px 0px 98px;"><span class="glyphicon glyphicon-bullhorn"></span> Set: <span id="setletter"> -- </span></div>
              </div>
              
              <div style="margin-top:5px;"></div>
              
              <div style="width:800px; margin-top:10px;">
                <div style="float:right; margin-bottom:6px;" class="btn-group dropup">
                  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">Action <span class="caret"></span></button>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="#" id="actionDelete">Delete</a></li>
                  </ul>
                </div>
                
              </div>
              <div class="pianorollcanvas">
                <canvas id="pianoroll"></canvas>
                <div id="memoryCanvas" sytle="display:none;"></div>
              </div>
              <div style="margin-top:10px;"></div>
            </div>
          </div>
          <!-- ピアノロール ここまで -->
      
      
      
      <!-- fileImport -->
      <div class="modal fade" id="fileImport" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title">Modal title</h4>
            </div>
            <div class="modal-body">
              <div><input type="file" id="import" class="form-control" name="files[]" style="width:200px; margin:0px 10px 0px 0px; "></span></div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary">Save changes</button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->
      
      <!-- MIDI IN -->
      <div class="modal fade" id="midiInSelM" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title"><span class="glyphicon glyphicon-log-in"></span> MIDI IN</h4>
            </div>
            <div class="modal-body">
              <div id="divMidiInSelWarning"></div>
              <select id="midiInSel" type="text" class="form-control input"></select>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" id="midiInSelB">Set MIDI IN</button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->
      
      <!-- MIDI OUT -->
      <div class="modal fade" id="midiOutSelM" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title"><span class="glyphicon glyphicon-log-out"></span> MIDI OUT</h4>
            </div>
            <div class="modal-body">
              <div id="divMidiOutSelWarning"></div>
              <select id="midiOutSel" type="text" class="form-control"></select>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" id="midiOutSelB">Set MIDI OUT</button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->

      <!--ToU -->
      <div class="modal fade" id="showToU" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content" style="width:640px;">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title"><span class="glyphicon glyphicon-check"></span> Terms of Use</h4>
            </div>
            <div class="modal-body">
              <textarea id="regContent" style="width:600px; height:260px;"></textarea>
              
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">閉じる</button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->

      <!-- New Track Modal -->
      <div class="modal fade" id="newTrackM" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title"><span class="glyphicon glyphicon-log-out"></span> 新しいTrack</h4>
            </div>
            <div class="modal-body">
				<%= form_for @project , :html => {:class=> 'form-control'} do |f| %>
					<%= f.label :track_name %>
					<%= text_field :track, :name, :id => 'track_name' %><br />
					<%= f.label :insturument_id %>
					<%= f.collection_select :id, Instrument.all, :id, :name %>
				<%- end -%>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" id="newTrackB">作成</button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->
      <%= link_to_function "トラック出力","dbout()" %>


      




	<%= form_for(@project) do |f| %>
	<% if @project.errors.any? %>
	<div id="error_explanation">
	  <h2><%= pluralize(@project.errors.count, "error") %> prohibited this project from being saved:</h2>
	
	  <ul>
	  <% @project.errors.full_messages.each do |msg| %>
	<li><%= msg %></li>
	  <% end %>
	  </ul>
	</div>
	  <% end %>
	
	  <div class="actions">
	<%= f.submit %>
	  </div>
	
	<% end %>
<!--- 追加 トラックを追加するための非表示form --->
	<%= form_tag "/ajax/dbout",{:remote=>true,:name=>"dbform"} do  %>
    <%= text_field :track, :name ,:id=>"t_name" %>
    <%= text_field :track, :instrument ,:id=>"t_instrument" %>
    <%= text_area :track, :score,:id=>"t_score" %>
    <%= text_field :track, :project_id,:id=>"t_project_id" %>
    <%= text_field :track, :user_id,:id=>"t_user_id" %>
  <% end %></br>
  <%= render 'errmsg' %>
<!--- 追加 トラックを追加するための非表示form end--->

    <script type="text/javascript" src="/javascripts/jquery.js"></script>
    <script type="text/javascript" src="/javascripts/bootstrap.min.js"></script>

    <script type="text/javascript">
    $(function () {
        // add include javcascript
        var scList=[
            {"type":"text/javascript", "script":"/javascripts/WebMIDIAPI.js"},
            {"type":"text/javascript", "script":"/javascripts/pianoroll.js"},
            {"type":"text/javascript", "script":"/javascripts/nsx1.js"},
            {"type":"text/javascript", "script":"/javascripts/regulation.js"},
            {"type":"text/javascript", "script":"/javascripts/app.js"},
        ];

        for(var i=0; i<scList.length; i++) {
            var tscr=document.createElement("script");
            tscr.type=scList[i].type;
            tscr.src=scList[i].script;
            document.body.appendChild(tscr);
        }
    });
    </script>
    <script>
       function dbout(){
        var that=pRoll;
        var inputtext=document.getElementById("inputText").value;
        var content=JSON.stringify({inputText:inputtext,noteStack:pRoll.noteStack});
        document.getElementById("t_name").value = "無名の人"
        document.getElementById("t_instrument").value = 1
        document.getElementById("t_score").value = content
        document.getElementById("t_project_id").value = 2
        document.getElementById("t_user_id").value = 1
        document.dbform.submit();
      }
    </script>
